working code. need to clean up and add comments
